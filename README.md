# My Local Observability Tool

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

-----

## –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏?

* **Prometheus**: –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ç–≤–æ–∏ –º–µ—Ç—Ä–∏–∫–∏.
* **Grafana**: –ö—Ä–∞—Å–∏–≤–æ –ø–æ–∫–∞–∂–µ—Ç —Ç–µ–±–µ –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏ –∏ —Ç—Ä–µ–π—Å—ã.
* **Loki**: –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—Å–µ—Ö —Ç–≤–æ–∏—Ö –ª–æ–≥–æ–≤.
* **Vector**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Ä—É–ª–∏—Ç –ª–æ–≥–∞–º–∏ —Å Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
* **cAdvisor**: –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä—è–º–∏–∫–æ–º –∏–∑ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
* **Jaeger**: –ß–∏—Å—Ç–æ –¥–ª—è —Ç—Ä–µ–π—Å–æ–≤, –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ.
* **OpenTelemetry Collector**: –°–æ–±–∏—Ä–∞–µ—Ç –∏ –≥–æ–Ω–∏—Ç —Ç—Ä–µ–π—Å—ã –≤ Jaeger.

-----

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

* `.env`: –¢—É—Ç –ª–µ–∂–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Docker Compose, —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
* `docker-compose.yaml`: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã.
* `Makefile`: –¢–≤–æ—è –ø–∞–ª–æ—á–∫–∞-–≤—ã—Ä—É—á–∞–ª–æ—á–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–µ–∫–æ–º.
* `config/`: –ó–¥–µ—Å—å –≤—Å—è –∫–æ–Ω—Ñ–∞.
  * `loki/loki.yaml`: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Loki.
  * `otel/otel-collector.yaml`: –ö–æ–Ω—Ñ–∏–≥ OpenTelemetry Collector.
  * `vector/vector.yaml`: –ö–æ–Ω—Ñ–∏–≥ Vector.
  * `grafana/`:
    * `datasource.yaml`: –ö–∞–∫–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å —É Grafana (Loki, Prometheus, Jaeger).
    * `provisioning/dashboards/default.yaml`: –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤ –≤ Grafana.
    * `my_entrypoint.sh`: –°–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ñ–∏–∫—Å–∏—Ç UID Prometheus –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö Grafana.
  * `prometheus/prometheus.yaml`: –ö–æ–Ω—Ñ–∏–≥ Prometheus —Å —Ü–µ–ª—è–º–∏ –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.
* `data/`: –ú–µ—Å—Ç–æ, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–∞–º).
* `dashboards/`: JSON-—Ñ–∞–π–ª—ã —Å –¥–∞—à–±–æ—Ä–¥–∞–º–∏ Grafana, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–æ–º –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è.
  * `cadvisor_docker.json`, `logs.json`, `vector.json`: –ü—Ä–∏–º–µ—Ä—ã –¥–∞—à–±–æ—Ä–¥–æ–≤.

-----

### –ì–æ—Ç–æ–≤—ã–µ –î–∞—à–±–æ—Ä–¥—ã Grafana

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤. –ö–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Grafana –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞:

* **cAdvisor Dashboard**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
  ![cAdvisor Dashboard](./docs/img/cadvisor_dashboard.png)

* **Golang Dashboard**: –ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Golang-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ).
  ![Golang Dashboard](./docs/img/golang_dashboard.png)

* **Logs Dashboard**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤ –∏–∑ Loki.
  ![Logs Dashboard](./docs/img/logs_dashboard.png)

* **Vector Dashboard**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã Vector.
  ![Vector Dashboard](./docs/img/vector_dashboard.png)

–ß—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å –≤–µ—Å—å —ç—Ç–æ—Ç —Å—Ç–µ–∫ –≤ —Ñ–æ–Ω–µ, –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–µ—Ä–∏:

```bash
make up
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å—ë: Prometheus, Grafana, Loki, Vector, cAdvisor, Jaeger –∏ OpenTelemetry Collector.

-----

## –†–µ—Å—É—Ä—Å—ã

–¢—ã, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –∏ —Å–∞–º –∑–Ω–∞–µ—à—å, –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å–∞ –≤ `/etc/hosts`. –ù–æ –µ—Å–ª–∏ –ª–µ–Ω—å, `make add-hosts` —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ —Ç–µ–±—è. –ê `make remove-hosts` –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –∑–∞—á–µ–º, –Ω–æ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –≤–∑–∞–¥, –æ–Ω–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥—É—Ç –∂–∏—Ç—å –≤–µ—á–Ω–æÔ∏è üòé.

```bash
make add-hosts
```

–í–æ—Ç —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–±–µ –ø—Ä–∏–≥–æ–¥—è—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `grafana jaeger loki otel-collector prometheus vector`.

-----

### –°—Å—ã–ª–æ—á–∫–∏ (–ø–æ—Å–ª–µ `make add-hosts`)

–ß—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (UI):

* **Grafana**: [http://grafana:3000](https://www.google.com/search?q=http://grafana:3000) *admin/admin (–¥–µ—Ñ–æ–ª—Ç)*
* **Prometheus**: [http://prometheus:3001](https://www.google.com/search?q=http://prometheus:3001)
* **Jaeger UI**: [http://jaeger:16686](https://www.google.com/search?q=http://jaeger:16686)
* **Vector UI**: [http://vector:8383](https://www.google.com/search?q=http://vector:8383)
* **cAdvisor**: [http://cadvisor:9081](https://www.google.com/search?q=http://cadvisor:9081)

–ß—Ç–æ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã):

* **Loki**:
  * `loki:3100` (–¥–ª—è –ø—Ä–∏–µ–º–∞ –ª–æ–≥–æ–≤ –æ—Ç Promtail, Fluentd, Fluent Bit –∏–ª–∏ Vector)
* **OpenTelemetry Collector**:
  * `otel-collector:9464` (–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ Prometheus –¥–ª—è —Å–∞–º–æ–≥–æ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞)
  * `otel-collector:4317 OTEL gRPC`
  * `otel-collector:4317 OTEL HTTP`
* **Vector**:
  * `vector:4545/udp` (–¥–ª—è –ø—Ä–∏–µ–º–∞ –ª–æ–≥–æ–≤ –ø–æ UDP, –Ω–∞–ø—Ä–∏–º–µ—Ä, Syslog)

-----

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ—Ä–≤–∏—Å–∞–º–∏

`Makefile` –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ —Ä—É–ª–∏—Ç—å —Å—Ç–µ–∫–æ–º.

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –£–¥–∞–ª–µ–Ω–∏–µ

–ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
make down
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –õ–æ–≥–æ–≤

* –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫):
  ```bash
  make logs
  ```
* –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Loki):
  ```bash
  make logs-s s=loki
  ```

-----

## –û—á–∏—Å—Ç–∫–∞ –î–∞–Ω–Ω—ã—Ö

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.

### –û—á–∏—Å—Ç–∫–∞ –í—Å–µ–≥–æ

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å—ë –∏ —É–¥–∞–ª–∏—Ç **–≤—Å–µ —Ç–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ** (–º–µ—Ç—Ä–∏–∫–∏ Prometheus, –ª–æ–≥–∏ Loki, –¥–∞–Ω–Ω—ã–µ Grafana, Jaeger –∏ Vector):

```bash
make clean
```

### –û—á–∏—Å—Ç–∫–∞ –û—Ç–¥–µ–ª—å–Ω—ã—Ö –°–µ—Ä–≤–∏—Å–æ–≤

–ú–æ–∂–µ—à—å –ø–æ—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:

* **Grafana**:
  ```bash
  make clean-grafana
  ```
* **Loki**:
  ```bash
  make clean-loki
  ```
* **Prometheus**:
  ```bash
  make clean-prometheus
  ```
* **Jaeger**:
  ```bash
  make clean-jaeger
  ```
* **Vector**:
  ```bash
  make clean-vector
  ```

-----

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –û—Ç–ª–∞–¥–∫–∞

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏–ª –≤ –∫–æ–Ω—Ñ–∏–≥–∞—Ö –∏–ª–∏ Dockerfile'–∞—Ö –∏ —Ö–æ—á–µ—à—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å (—Å —á–∏—Å—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö):

```bash
make rebuild
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Vector

–ü—Ä–µ–∂–¥–µ —á–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å Vector, –º–æ–∂–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ –∫–æ–Ω—Ñ–∏–≥ –Ω–∞ –æ—à–∏–±–∫–∏:

```bash
make validate-vector
```

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Grafana

–ï—Å–ª–∏ –ø–æ–º–µ–Ω—è–ª –∫–æ–Ω—Ñ–∏–≥ Grafana –∏–ª–∏ –¥–∞—à–±–æ—Ä–¥—ã, –º–æ–∂–µ—à—å "–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å" —Å–µ—Ä–≤–∏—Å Grafana (—Å –æ—á–∏—Å—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö):

```bash
make full-reload-grafana
```

-----

## –ó–∞–º–µ—Ç–∫–∏ –ø–æ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

* **Vector**: –°–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ Docker, —Å–≤–æ—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é –∏ –≥–æ–Ω–∏—Ç –≤—Å—ë –≤ Loki. –ï—â—ë –æ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–≤–æ–∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Prometheus.
* **Grafana**: –ê–≤—Ç–æ–º–∞—Ç–æ–º –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∞—à–±–æ—Ä–¥—ã –∏–∑ –Ω—É–∂–Ω—ã—Ö –ø–∞–ø–æ–∫. –°–∫—Ä–∏–ø—Ç `my_entrypoint.sh` –ø–æ–ø—Ä–∞–≤–ª—è–µ—Ç UID Prometheus –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö.
* **Loki**: –•—Ä–∞–Ω–∏—Ç —á–∞–Ω–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.
* **OpenTelemetry Collector**: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ —Ç—Ä–µ–π—Å—ã –ø–æ OTLP (gRPC –∏ HTTP), —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—è –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus –∏ —Ç—Ä–µ–π—Å—ã –≤ Jaeger.
* **–†–µ—Å—É—Ä—Å—ã**: –õ–∏–º–∏—Ç—ã CPU –∏ –ø–∞–º—è—Ç–∏ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (`GRAFANA_CPUS_LIMIT`, `LOKI_CPUS_LIMIT` –∏ —Ç.–¥.) –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `.env` —Ñ–∞–π–ª.
